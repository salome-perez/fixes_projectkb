public class DiskFileItem {
    private void readObject(ObjectInputStream in)
            throws IOException, ClassNotFoundException {
    	if (!Boolean.getBoolean(SERIALIZABLE_PROPERTY)) {
    		throw new IllegalStateException("Property " + SERIALIZABLE_PROPERTY
    				+ " is not true, rejecting to deserialize a DiskFileItem.");
    	}
        // read values
        in.defaultReadObject();

        if (repository != null) {
            if (repository.isDirectory()) {
                // Check path for nulls
                if (repository.getPath().contains("\0")) {
                    throw new IOException(format(
                            "The repository [%s] contains a null character",
                            repository.getPath()));
                }
            } else {
                throw new IOException(format(
                        "The repository [%s] is not a directory",
                        repository.getAbsolutePath()));
            }
        }

        OutputStream output = getOutputStream();
        if (cachedContent != null) {
            output.write(cachedContent);
        } else {
            FileInputStream input = new FileInputStream(dfosFile);
            IOUtils.copy(input, output);
            dfosFile.delete();
            dfosFile = null;
        }
        output.close();

        cachedContent = null;
    }

}