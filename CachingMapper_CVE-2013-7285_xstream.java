public class CachingMapper {
    public Class realClass(String elementName) {
        Object cached = realClassCache.get(elementName);
        if (cached != null) {
            if (cached instanceof Class) {
                return (Class)cached;
            }
            throw (XStreamException)cached;
        }

        try {
            Class result = super.realClass(elementName);
            realClassCache.put(elementName, result);
            return result;
        } catch (ForbiddenClassException e) {
            realClassCache.put(elementName, e);
            throw e;
        } catch (CannotResolveClassException e) {
            realClassCache.put(elementName, e);
            throw e;
        }
    }

}