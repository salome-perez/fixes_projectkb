public class TcpDiscoverySpi {
    @IgniteInstanceResource
    @Override protected void injectResources(Ignite ignite) {
        super.injectResources(ignite);

        // Inject resource.
        if (ignite != null) {
            setLocalAddress(ignite.configuration().getLocalHost());
            setAddressResolver(ignite.configuration().getAddressResolver());

            if (ignite instanceof IgniteKernal) // IgniteMock instance can be injected from tests.
                marsh = ((IgniteKernal)ignite).context().marshallerContext().jdkMarshaller();
            else
                marsh = new JdkMarshaller();
        }
    }

}