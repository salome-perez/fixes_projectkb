public class MapReduceClient {
    public GridClient client() throws IOException {
        GridClient cli0 = cli;

        if (cli0 == null) {
            synchronized (mux) {
                cli0 = cli;

                if (cli0 == null) {
                    GridClientConfiguration cliCfg = new GridClientConfiguration();

                    cliCfg.setProtocol(TCP);
                    cliCfg.setServers(addrs);

                    try {
                        IgnitePredicate<String> clsFilter =
                            MarshallerUtils.classNameFilter(this.getClass().getClassLoader());

                        cliCfg.setMarshaller(new GridClientJdkMarshaller(clsFilter));
                    }
                    catch (IgniteCheckedException e) {
                        throw new IgniteException(e);
                    }

                    cliCfg.setMaxConnectionIdleTime(24 * 60 * 60 * 1000L); // 1 day.
                    cliCfg.setDaemon(true);

                    try {
                        cli0 = GridClientFactory.start(cliCfg);

                        cli = cli0;
                    }
                    catch (GridClientException e) {
                        throw new IOException("Failed to establish connection with Ignite: " + addrs, e);
                    }
                }
            }
        }

        return cli0;
    }

}