public class ClientAuthenticationFilter {
    @Override
    protected void unsuccessfulAuthentication(HttpServletRequest request, HttpServletResponse response,
                    AuthenticationException failed) throws IOException, ServletException {
        // Need to force a redirect via the OAuth client filter, so rethrow here
        // if OAuth related
        if (oauth2Available && failed instanceof SocialRedirectException) {
            throw ((SocialRedirectException) failed).getUserRedirectException();
        }
        if (oauthAvailable
                        && failed instanceof org.springframework.security.oauth.consumer.AccessTokenRequiredException) {
            throw failed;
        }
        else {
            // If the exception is not a Spring Security exception this will
            // result in a default error page
            super.unsuccessfulAuthentication(request, response, failed);
        }
    }

}