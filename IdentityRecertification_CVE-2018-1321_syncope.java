public class IdentityRecertification {
    @Override
    protected String doExecute(final boolean dryRun) throws JobExecutionException {
        LOG.info("IdentityRecertification {} running [SchedTask {}]", dryRun ? "dry " : "", task.getKey());

        init();
        if (recertificationTime == -1) {
            LOG.debug("Identity Recertification disabled");
            return ("IDENTITY RECERTIFICATION DISABLED");
        }

        if (dryRun) {
            return "DRY RUN";
        }

        int total = userDAO.count();
        int pages = (total / AnyDAO.DEFAULT_PAGE_SIZE) + 1;

        status.set("Processing " + total + " users in " + pages + " pages");

        long now = System.currentTimeMillis();
        for (int page = 1; page <= pages && !interrupt; page++) {
            status.set("Processing " + total + " users: page " + page + " of " + pages);

            List<User> users = userDAO.findAll(page, AnyDAO.DEFAULT_PAGE_SIZE);
            for (int i = 0; i < users.size() && !interrupt; i++) {
                LOG.debug("Processing user: {}", users.get(i).getUsername());

                if (StringUtils.isNotBlank(users.get(i).getWorkflowId()) && isToBeRecertified(users.get(i), now)) {
                    uwfAdapter.requestCertify(users.get(i));
                } else {
                    LOG.warn("Workflow for {} is null or empty", users.get(i));
                }
            }
        }
        if (interrupt) {
            interrupted = true;
            return "Identity recertification interrupted";
        }

        return "SUCCESS";
    }

}