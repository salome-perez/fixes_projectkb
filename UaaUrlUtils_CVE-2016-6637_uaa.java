public class UaaUrlUtils {
    public static String getUaaUrl(String path, boolean zoneSwitchPossible) {
        return getURIBuilder(path, zoneSwitchPossible).build().toUriString();
    }

    public static UriComponentsBuilder getURIBuilder(String path, boolean zoneSwitchPossible) {
        UriComponentsBuilder builder = ServletUriComponentsBuilder.fromCurrentContextPath().path(path);
        if (zoneSwitchPossible) {
            String host = builder.build().getHost();
            IdentityZone current = IdentityZoneHolder.get();
            if (host != null && !IdentityZoneHolder.isUaa()) {
                if (!host.startsWith(current.getSubdomain() + ".")) {
                    host = current.getSubdomain() + "." + host;
                    builder.host(host);
                }
            }
        }
        return builder;
    }

}