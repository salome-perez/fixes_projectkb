public class Activator {
    protected void doStart() throws Exception {
        featuresPlugin = new FeaturesPlugin();
        featuresPlugin.setBundleContext(bundleContext);
        featuresPlugin.setFeaturesService(getTrackedService(FeaturesService.class));
        featuresPlugin.start();

        Dictionary<String, String> props = new Hashtable<>();
        props.put("felix.webconsole.label", "features");
        register(Servlet.class, featuresPlugin, props);
    }

    @Override
    protected void doStop() {
        super.doStop();
        if (featuresPlugin != null) {
            featuresPlugin.stop();
            featuresPlugin = null;
        }
    }

}