public class IdentityInputFilter {
    @Override
    public long end()  throws IOException {

        if (maxSwallowSize > -1 && remaining > maxSwallowSize) {
            throw new IOException(sm.getString("inputFilter.maxSwallow"));
        }

        // Consume extra bytes.
        while (remaining > 0) {
            int nread = buffer.doRead(endChunk, null);
            if (nread > 0 ) {
                remaining = remaining - nread;
            } else { // errors are handled higher up.
                remaining = 0;
            }
        }

        // If too many bytes were read, return the amount.
        return -remaining;

    }

}