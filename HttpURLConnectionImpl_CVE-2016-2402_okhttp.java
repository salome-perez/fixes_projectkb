public class HttpURLConnectionImpl {
    @Override public final Permission getPermission() throws IOException {
        URL url = getURL();
        String hostname = url.getHost();
        int hostPort = url.getPort() != -1
            ? url.getPort()
            : HttpUrl.defaultPort(url.getProtocol());
        if (usingProxy()) {
          InetSocketAddress proxyAddress = (InetSocketAddress) client.proxy().address();
          hostname = proxyAddress.getHostName();
          hostPort = proxyAddress.getPort();
        }
        return new SocketPermission(hostname + ":" + hostPort, "connect, resolve");
      }
}