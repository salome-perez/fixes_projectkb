public class ChangePasswordIT {
    @Test
    public void displaysErrorWhenPasswordContravenesPolicy() {
        //the only policy we can contravene by default is the length

        String newPassword = new RandomValueStringGenerator(260).generate();
        webDriver.get(baseUrl + "/change_password");
        signIn(userEmail, PASSWORD);

        changePassword(PASSWORD, newPassword, newPassword);
        WebElement errorMessage = webDriver.findElement(By.className("error-message"));
        assertTrue(errorMessage.isDisplayed());
        assertEquals("Password must be no more than 255 characters in length.", errorMessage.getText());
    }

    @Test
    public void testChangePassword() throws Exception {
        webDriver.get(baseUrl + "/change_password");
        signIn(userEmail, PASSWORD);

        changePassword(PASSWORD, NEW_PASSWORD, "new");
        WebElement errorMessage = webDriver.findElement(By.className("error-message"));
        assertTrue(errorMessage.isDisplayed());
        assertEquals("Passwords must match and not be empty.", errorMessage.getText());

        changePassword(PASSWORD, NEW_PASSWORD, NEW_PASSWORD);
        signOut();

        signIn(userEmail, NEW_PASSWORD);
    }

    private void signIn(String userName, String password) {
        webDriver.findElement(By.name("username")).sendKeys(userName);
        webDriver.findElement(By.name("password")).sendKeys(password);
        webDriver.findElement(By.xpath("//input[@value='Sign in']")).click();
    }

}